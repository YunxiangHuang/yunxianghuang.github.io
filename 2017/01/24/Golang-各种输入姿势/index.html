<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="go,input,stdin,hacker rank,hello world," />





  <link rel="alternate" href="/atom.xml" title="無痕的碎碎念" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="最近开始在Hacker Rank上面刷题玩，因为从开始工作起一直是用的Go语言作为主力开发语言，所以就选择用Go语言来解题了。
刚开始做第一题Hello World，突然发现自己还没用Go语言从stdin读取过数据。于是自己摸索加各种地方找了一下资料，打算总结一下Go语言从标准输入读取数据的姿势。">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang 各种输入姿势">
<meta property="og:url" content="http://wuhenqs.com/2017/01/24/Golang-各种输入姿势/index.html">
<meta property="og:site_name" content="無痕的碎碎念">
<meta property="og:description" content="最近开始在Hacker Rank上面刷题玩，因为从开始工作起一直是用的Go语言作为主力开发语言，所以就选择用Go语言来解题了。
刚开始做第一题Hello World，突然发现自己还没用Go语言从stdin读取过数据。于是自己摸索加各种地方找了一下资料，打算总结一下Go语言从标准输入读取数据的姿势。">
<meta property="og:updated_time" content="2017-01-25T03:47:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Golang 各种输入姿势">
<meta name="twitter:description" content="最近开始在Hacker Rank上面刷题玩，因为从开始工作起一直是用的Go语言作为主力开发语言，所以就选择用Go语言来解题了。
刚开始做第一题Hello World，突然发现自己还没用Go语言从stdin读取过数据。于是自己摸索加各种地方找了一下资料，打算总结一下Go语言从标准输入读取数据的姿势。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wuhenqs.com/2017/01/24/Golang-各种输入姿势/"/>





  <title> Golang 各种输入姿势 | 無痕的碎碎念 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">無痕的碎碎念</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/yunxianghuang" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github"></i> <br />
            
            Github
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://wuhenqs.com/2017/01/24/Golang-各种输入姿势/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Yunxiang Huang">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/7898555">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="無痕的碎碎念">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="無痕的碎碎念" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Golang 各种输入姿势
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-24T15:21:22+08:00">
                2017-01-24
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近开始在<a href="https://hackerrank.com" target="_blank" rel="external">Hacker Rank</a>上面刷题玩，因为从开始工作起一直是用的Go语言作为主力开发语言，所以就选择用Go语言来解题了。</p>
<p>刚开始做第一题<a href="https://www.hackerrank.com/challenges/30-hello-world" target="_blank" rel="external">Hello World</a>，突然发现自己还没用Go语言从<code>stdin</code>读取过数据。于是自己摸索加各种地方找了一下资料，打算总结一下Go语言从标准输入读取数据的姿势。</p>
<a id="more"></a>
<h2 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a><code>fmt</code></h2><p>经常使用<code>fmt.Printf</code>之类的做<ruby>输出<rp> (</rp><rt>tiáo shì</rt><rp>) </rp></ruby>，在处理输入自然是第一个想到<code>fmt</code>包。</p>
<p><code>fmt</code>提供了许多输入函数：</p>
<ul>
<li><code>Scan</code></li>
<li><code>Scanf</code></li>
<li><code>Scanln</code></li>
</ul>
<p>由于只讲从<code>stdin</code>读取，所以其他的<code>Fscanf</code>、<code>Sscanf</code>之类的就省略了，下面逐一来玩一下这三个输入。</p>
<h3 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a><code>Scan</code></h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scan</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>Scan</code>从标准输入读取数据，以空格作为分隔（换行符也视作空格），依次将输入赋给参数。他会返回读取参数的个数，和读取过程中遇到的错误。</p>
<p>来个例子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Code:</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line">  <span class="keyword">var</span> d <span class="keyword">float32</span></div><div class="line">  <span class="keyword">var</span> s <span class="keyword">string</span></div><div class="line">  fmt.Scan(&amp;i, &amp;d, &amp;s)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Input:</span></div><div class="line"><span class="number">1</span> <span class="number">2.2</span></div><div class="line">Three</div></pre></td></tr></table></figure>
<p>上述代码接受上述输入之后，<code>i</code>里面存储的是<code>1</code>，<code>d</code>里面存储的是<code>2.2</code>，<code>s</code>里面存储的是<code>Three</code>。</p>
<p>需要注意的一点是：因为<code>Scan</code>是以空格和换行作为分隔，所以<code>Scan</code>不能将一整行作为一个字符串。<br>例子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Code:</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> s <span class="keyword">string</span></div><div class="line">  fmt.Scan(&amp;s)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Input:</span></div><div class="line">This is a <span class="keyword">string</span>.</div></pre></td></tr></table></figure>
<p>上述代码接受上述输入之后，<code>s</code>里面存储的是<code>This</code>，而<code>is a string</code>会继续保留在<code>stdin</code>中。</p>
<h3 id="Scanf"><a href="#Scanf" class="headerlink" title="Scanf"></a><code>Scanf</code></h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scanf</span><span class="params">(format <span class="keyword">string</span>, a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>Scanf</code> 和<code>Scan</code>类似，只是可以自己定义输入格式。</p>
<p>来个例子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Code:</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line">  <span class="keyword">var</span> d <span class="keyword">float32</span></div><div class="line">  <span class="keyword">var</span> s <span class="keyword">string</span></div><div class="line">  fmt.Scanf(<span class="string">"%d %f %s"</span>, &amp;i, &amp;d, &amp;s)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Input:</span></div><div class="line"><span class="number">1</span> <span class="number">2.2</span></div><div class="line">Three</div></pre></td></tr></table></figure>
<p>上述代码接受上述输入之后，<code>i</code>里面存储的是<code>1</code>，<code>d</code>里面存储的是<code>2.2</code>，<code>s</code>依然是空字符串。因为给定的输入格式是<code>%d %f %s</code>，而<code>Three</code>和<code>2.2</code>之间的是<code>\n</code>。所以<code>Three</code>并没有存储到<code>s</code>中。把输入格式改成<code>%d %f\n%s</code>就可以顺利读取了。</p>
<p><code>Scanf</code>的格式控制非常强大，可以做很多事情，例如指定长度：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Code:</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> i, j <span class="keyword">int</span></div><div class="line">  fmt.Scanf(<span class="string">"%3d%2d"</span>, &amp;i, &amp;j)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Input:</span></div><div class="line"><span class="number">1234567</span></div></pre></td></tr></table></figure>
<p>上述代码接受上述输入之后，<code>i</code>里面存储的是<code>123</code>，<code>j</code>里面存储的是<code>45</code>，而<code>67</code>依然保留在<code>stdin</code>中。</p>
<h3 id="Scanln"><a href="#Scanln" class="headerlink" title="Scanln"></a><code>Scanln</code></h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Scanln</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>Scanln</code>和<code>Scan</code>几乎一样，只不过<code>Scanln</code>将换行符作为一次输入的结束。</p>
<p>来个栗子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Code:</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> i <span class="keyword">int</span></div><div class="line">  <span class="keyword">var</span> d <span class="keyword">float32</span></div><div class="line">  <span class="keyword">var</span> s <span class="keyword">string</span></div><div class="line">  fmt.Scanln(&amp;i, &amp;d, &amp;s)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Input:</span></div><div class="line"><span class="number">1</span> <span class="number">2.2</span></div><div class="line">Three</div></pre></td></tr></table></figure>
<p>上述代码接受上述输入之后，<code>i</code>里面存储的是<code>1</code>，<code>d</code>里面存储的是<code>2.2</code>，<code>s</code>依然是空字符串。因为<code>Scanln</code>将换行符作为输入的结束，所以<code>Three</code>被保留在了<code>stdin</code>中。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><code>fmt</code>中提供了非常方便而且强大的输入函数，基本可以满足<ruby>各种<rp> (</rp><rt>qí guài</rt><rp>) </rp></ruby>输入需求了。但是目前还没找到方法能一次读取一整行。</p>
<h2 id="bufio"><a href="#bufio" class="headerlink" title="bufio"></a><code>bufio</code></h2><p><code>bufio</code>是在处理各种I/O的时候常用的包之一，他实现了各种带缓冲的I/O。其中有两个和输入有关的结构：</p>
<ul>
<li><code>Reader</code></li>
<li><code>Scanner</code></li>
</ul>
<p>下面来看一下这两货怎么玩.</p>
<h3 id="Reader"><a href="#Reader" class="headerlink" title="Reader"></a><code>Reader</code></h3><p><code>Reader</code>是<code>bufio</code>中提供的一个带缓存的<code>Reader</code>，通过<code>NewReader</code>创建的<code>Reader</code>的默认缓存大小是4096 byte。也可以通过<code>NewReaderSize</code>来创建一个自定义缓存大小的<code>Reader</code>，不过缓存最小是16 byte。</p>
<p>来个例子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="comment">// Default size.</span></div><div class="line">  reader := bufio.NewReader(os.Stdin)</div><div class="line">  <span class="comment">// Custom size.</span></div><div class="line">  reader = bufio.NewReaderSize(os.Stdin, <span class="number">1024</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码先后创建了两个<code>Reader</code>，都是对<code>stdin</code>进行操作的。其中第一个<code>Reader</code>的缓存大小是4096 byte，第二个的缓存大小是1024 byte。</p>
<p><code>Reader</code>提供了很多很好用的读取函数：</p>
<ul>
<li><code>Read</code></li>
<li><code>ReadBytes</code></li>
<li><code>ReadSlice</code></li>
<li><code>ReadByte</code></li>
<li><code>ReadRune</code></li>
<li><code>ReadString</code></li>
<li><code>ReadLine</code></li>
</ul>
<p>还有一些和输入没太大关系我就忽略了，在函数列表里面看到了<code>ReadLine</code>，不能更激动，终于可以一次读取一行了，不过还是一个一个来讲一下。</p>
<h4 id="Read"><a href="#Read" class="headerlink" title="Read"></a><code>Read</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">Read</span><span class="params">(p []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>Read</code>函数需要一个byte切片作为参数，一次读取最多将给定的切片读满。返回值是实际读取的字节数，以及读取过程中遇到的错误。</p>
<h4 id="ReadBytes"><a href="#ReadBytes" class="headerlink" title="ReadBytes"></a><code>ReadBytes</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadBytes</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span></div></pre></td></tr></table></figure>
<p><code>ReadBytes</code>函数需要给定一个byte作为参数，然后他会一直读取，直到读取到给定的byte，<code>EOF</code>或者在读取过程中发生错误。</p>
<p>从源码里面看到了官方的一行<ruby>注释<rp> (</rp><rt>tǔ cáo</rt><rp>) </rp></ruby>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">// For simple uses, a Scanner may be more convenient.</div></pre></td></tr></table></figure>
<p>所以没有什么特殊需求的话，还是推荐使用之后讲的<code>Scanner</code></p>
<h4 id="ReadSlice"><a href="#ReadSlice" class="headerlink" title="ReadSlice"></a><code>ReadSlice</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadSlice</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(line []<span class="keyword">byte</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>ReadSlice</code>函数需要给定一个byte作为参数，然后他会一直读取，直到读取到给定的byte，<code>EOF</code>或者发生错误。</p>
<p><code>ReadSlice</code>和<code>ReadBytes</code>的区别在于：<code>ReadBytes</code>是<strong>有I/O操作的</strong>，而<code>ReadSlice</code><strong>没有I/O操作</strong>。<code>ReadSlice</code>的读取仅限于<strong>已经缓存</strong>的部分，而<code>ReadBytes</code>会一直读取输入和刷新缓存。</p>
<p>所以如果某一次调用<code>ReadSlice</code>把缓存读完了的话，后面再调用是不会返回任何结果的，需要调用<code>ReadBytes</code>或者<code>ReadString</code>触发下一次I/O操作。所以一般情况下直接调用<code>ReadBytes</code>和<code>ReadString</code>相对来说好一些。</p>
<h4 id="ReadByte"><a href="#ReadByte" class="headerlink" title="ReadByte"></a><code>ReadByte</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadByte</span><span class="params">()</span> <span class="params">(<span class="keyword">byte</span>, error)</span></span></div></pre></td></tr></table></figure>
<p><code>ReadByte</code>比较简单粗暴，就是直接读取一个byte的内容。</p>
<h4 id="ReadRune"><a href="#ReadRune" class="headerlink" title="ReadRune"></a><code>ReadRune</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadRune</span><span class="params">()</span> <span class="params">(r <span class="keyword">rune</span>, size <span class="keyword">int</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>Rune</code>是Go语言里面的字符类型，可以当做是C/C++里面的<code>char</code>，只不过<code>Rune</code>是UTF-8编码的，本质是<code>int32</code>的别名。</p>
<p><code>ReadRune</code>会读取一个<code>Rune</code>的内容，并且返回这个<code>Rune</code>占用了多少byte。</p>
<h4 id="ReadString"><a href="#ReadString" class="headerlink" title="ReadString"></a><code>ReadString</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadString</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span></div></pre></td></tr></table></figure>
<p><code>ReadString</code>函数需要给定一个byte作为参数，然后他会一直读取，直到读取到给定的byte，并将读取的内容转换成字符串返回。</p>
<p>从源码上来看，<code>ReadString</code>直接调用了<code>ReadBytes</code>读取数据，然后转换成了字符串。</p>
<h4 id="ReadLine"><a href="#ReadLine" class="headerlink" title="ReadLine"></a><code>ReadLine</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadLine</span><span class="params">()</span> <span class="params">(line []<span class="keyword">byte</span>, isPrefix <span class="keyword">bool</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p><code>ReadLine</code>会读取一整行的内容，如果这一行的数据很大，超过了缓存的大小，<code>isPrefix</code>会设置为<code>true</code>。</p>
<p>从源码上来看，<code>ReadLine</code>是调用了<code>ReadSlice</code>，所以<code>ReadLine</code>是没有I/O操作的，并且会丢掉换行符（<code>\n</code>或者<code>\r\n</code>）。</p>
<p>由于是调用了<code>ReadSlice</code>，所以不推荐使用<code>ReadLine</code>来读取一整行内容，而是使用<code>ReadBytes(&#39;\n&#39;)</code>或者<code>ReadString(&#39;\n&#39;)</code>来代替。</p>
<h4 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h4><p><code>Reader</code>提供的方法读取到的值都是<code>byte</code>，<code>rune</code>或者<code>string</code>类型的，用<code>Reader</code>来读取<code>int</code>或者<code>float32</code>等类型的话还不如直接用<code>fmt</code>包的<code>Scan</code>方法。</p>
<p>不过总算是能用<code>Reader</code>一次读取一整行了。</p>
<h3 id="Scanner"><a href="#Scanner" class="headerlink" title="Scanner"></a><code>Scanner</code></h3><p><code>Scanner</code>提供了一些接口，能很方便的一次读取一行，非常适合拿来读取文件之类的数据。<code>Scanner</code>只能通过<code>NewScanner</code>来创建，缓存大小最开始会设置为4096 byte，之后如果读取到更大的数据会自己调整，最大可以达到 65536 byte。</p>
<p>来个例子：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> scanner = bufio.NewScanner(os.Stdin)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码创建了一个<code>Scanner</code>，用来对<code>stdin</code>做操作。</p>
<p>在<code>Scanner</code>中有一个<code>token</code>的概念，一个<code>token</code>表示一次读取的内容，可以是一整行，也可以是自定义的一段数据，<code>token</code>之间的划分通过<code>SplitFunc</code>来进行，关于<code>SplitFunc</code>的内容包含在了<code>Split</code>函数中了，此处不再赘述。</p>
<p><code>Scanner</code>提供的方法相对<code>Reader</code>来说要少很多，主要有以下几个：</p>
<ul>
<li><code>Split</code></li>
<li><code>Scan</code></li>
<li><code>Bytes</code></li>
<li><code>Text</code></li>
</ul>
<h4 id="Split"><a href="#Split" class="headerlink" title="Split"></a><code>Split</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Scanner)</span> <span class="title">Split</span><span class="params">(split SplitFunc)</span></span></div></pre></td></tr></table></figure>
<p><code>Split</code> 是可以传入一个<code>SplitFunc</code>，传入的这个方法是用来帮忙界定“行”的，即你可以自己规定怎么样才算一“行”。默认的<code>SplitFunc</code>就是按行读入。</p>
<h5 id="SplitFunc"><a href="#SplitFunc" class="headerlink" title="SplitFunc"></a><code>SplitFunc</code></h5><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> SplitFunc <span class="function"><span class="keyword">func</span><span class="params">(data []<span class="keyword">byte</span>, atEOF <span class="keyword">bool</span>)</span> <span class="params">(advance <span class="keyword">int</span>, token []<span class="keyword">byte</span>, err error)</span></span></div></pre></td></tr></table></figure>
<p>一个标准的<code>SplitFunc</code>需要接受两个参数：</p>
<ul>
<li>读取到的原始数据</li>
<li>是否读取到<code>EOF</code>的标识</li>
</ul>
<p><code>SplitFunc</code>根据传入的两个参数进行处理，并返回三个值：</p>
<ul>
<li>本次分割的长度</li>
<li>实际读取到的内容</li>
<li>分割过程中发生的错误</li>
</ul>
<p>其中第一个返回值<strong>不一定</strong>就是<code>len(token)</code>用<code>Scanner</code>默认的<code>SplitFunc</code>来解释一下：</p>
<p><code>Scanner</code>默认使用的<code>SplitFunc</code>以<code>\n</code>作为分隔符，返回分割的长度，实际读取到的内容和分割过程中的错误，其中分割的长度包含了行尾的<code>\n</code>或者<code>\r\n</code>，而实际读取到的内容中不包含，所以<code>len(token)</code>是不等于<code>advance</code>的。而<code>advance</code>的值，可以看作是偏移量。</p>
<p>其次，还有一个需要注意的地方，如果想通过每次返回<code>advance</code>为<code>0</code>的方式来一直读取同一个<code>token</code>的话，会导致程序出现<strong>PANIC</strong>。因为在等下要介绍的<code>Scan</code>函数中做了判定：如果连续<strong>100</strong>次读取到的<code>token</code>不为空，但是<code>advance</code>等于0的话，会直接<strong>PANIC</strong>：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">panic</span>(<span class="string">"bufio.Scan: 100 empty tokens without progressing"</span>)</div></pre></td></tr></table></figure>
<p>当然，<code>advance</code>为负数的话就更不行了。</p>
<h4 id="Scan-1"><a href="#Scan-1" class="headerlink" title="Scan"></a><code>Scan</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Scanner)</span> <span class="title">Scan</span><span class="params">()</span> <span class="title">bool</span></span></div></pre></td></tr></table></figure>
<p>从函数前面上看，<code>Scan</code>非常简单，不接受任何参数，只返回一个布尔值来表示是否已经全部读取完毕。但是从源码中可以知道，<code>Scan</code>做了非常多的事情。</p>
<p>每次调用<code>Scan</code>都会读取一个<code>token</code>，并存放在内部。如果缓存大小不够了会自动扩大缓存。然后还有一些错误的处理等。</p>
<h4 id="Bytes"><a href="#Bytes" class="headerlink" title="Bytes"></a><code>Bytes</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Scanner)</span> <span class="title">Bytes</span><span class="params">()</span> []<span class="title">byte</span></span></div></pre></td></tr></table></figure>
<p><code>Bytes</code>是将上一次调用<code>Scan</code>所读取到的<code>token</code>以<code>[]byte</code>的形式返回。</p>
<p>所以连续多次调用<code>Bytes</code>会得到一模一样的结果。</p>
<h4 id="Text"><a href="#Text" class="headerlink" title="Text"></a><code>Text</code></h4><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Scanner)</span> <span class="title">Text</span><span class="params">()</span> <span class="title">string</span></span></div></pre></td></tr></table></figure>
<p><code>Text</code>和<code>Bytes</code>一样，只不过是将<code>token</code>转化成<code>string</code>再返回。</p>
<p>同样的，连续多次调用<code>Text</code>也会得到一模一样的结果。</p>
<h4 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h4><p><code>Scanner</code>如果能比较好的理解<code>token</code>和<code>SplitFunc</code>的话，用起来的确比<code>Reader</code>要方便很多。不过和<code>Reader</code>一样，获得的数据都是<code>[]byte</code>和<code>string</code>，如果要获取其他类型的数据的话需要再进行一次转换，不过这时候就不如直接用<code>fmt</code>的<code>Scan</code>函数来做了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>为了用Go语言做一个“Hello World”的大水题我也是够拼的，搞了这么多事情出来。通过这次的折腾，找资料，看源码了解到了许多平常不会注意到的事情：</p>
<p>反正不看源码我是不会知道<code>ReadSlice</code>和<code>ReadString</code>是一次性的 =。=</p>
<p>最后还是贴一发我的“Hello world”的源码：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">  <span class="string">"bufio"</span></div><div class="line">  <span class="string">"fmt"</span></div><div class="line">  <span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">  <span class="keyword">var</span> scan = bufio.NewScanner(os.Stdin)</div><div class="line">  <span class="keyword">if</span> scan.Scan() &#123;</div><div class="line">    fmt.Printf(<span class="string">"Hello, World.\n%s"</span>, scan.Text())</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/go/" rel="tag"># go</a>
          
            <a href="/tags/input/" rel="tag"># input</a>
          
            <a href="/tags/stdin/" rel="tag"># stdin</a>
          
            <a href="/tags/hacker-rank/" rel="tag"># hacker rank</a>
          
            <a href="/tags/hello-world/" rel="tag"># hello world</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/01/18/shell-script-trap/" rel="next" title="Shell Script - Trap">
                <i class="fa fa-chevron-left"></i> Shell Script - Trap
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars1.githubusercontent.com/u/7898555"
               alt="Yunxiang Huang" />
          <p class="site-author-name" itemprop="name">Yunxiang Huang</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#fmt"><span class="nav-number">1.</span> <span class="nav-text">fmt</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Scan"><span class="nav-number">1.1.</span> <span class="nav-text">Scan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scanf"><span class="nav-number">1.2.</span> <span class="nav-text">Scanf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scanln"><span class="nav-number">1.3.</span> <span class="nav-text">Scanln</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.4.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#bufio"><span class="nav-number">2.</span> <span class="nav-text">bufio</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Reader"><span class="nav-number">2.1.</span> <span class="nav-text">Reader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Read"><span class="nav-number">2.1.1.</span> <span class="nav-text">Read</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadBytes"><span class="nav-number">2.1.2.</span> <span class="nav-text">ReadBytes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadSlice"><span class="nav-number">2.1.3.</span> <span class="nav-text">ReadSlice</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadByte"><span class="nav-number">2.1.4.</span> <span class="nav-text">ReadByte</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadRune"><span class="nav-number">2.1.5.</span> <span class="nav-text">ReadRune</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadString"><span class="nav-number">2.1.6.</span> <span class="nav-text">ReadString</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ReadLine"><span class="nav-number">2.1.7.</span> <span class="nav-text">ReadLine</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结-1"><span class="nav-number">2.1.8.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Scanner"><span class="nav-number">2.2.</span> <span class="nav-text">Scanner</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Split"><span class="nav-number">2.2.1.</span> <span class="nav-text">Split</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SplitFunc"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">SplitFunc</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Scan-1"><span class="nav-number">2.2.2.</span> <span class="nav-text">Scan</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bytes"><span class="nav-number">2.2.3.</span> <span class="nav-text">Bytes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Text"><span class="nav-number">2.2.4.</span> <span class="nav-text">Text</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小结-2"><span class="nav-number">2.2.5.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yunxiang Huang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>
      <!-- UY END -->
  




  
  

  

  

  

  


</body>
</html>
